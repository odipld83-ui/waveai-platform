<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Param√®tres IA - WaveAI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --wave-primary: #0f4c75;
            --wave-secondary: #3282b8;
            --wave-accent: #bbe1fa;
            --wave-success: #27ae60;
            --wave-warning: #f39c12;
            --wave-error: #e74c3c;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--wave-primary) 0%, var(--wave-secondary) 100%);
            min-height: 100vh;
            color: white;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
        }
        
        .back-btn:hover { background: rgba(255, 255, 255, 0.3); }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(45deg, var(--wave-accent), #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .main-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .intro-section {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .intro-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--wave-accent), #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .intro-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }
        
        .settings-form {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .form-section {
            margin-bottom: 2.5rem;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--wave-accent);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-description {
            font-size: 0.95rem;
            opacity: 0.8;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--wave-accent);
        }
        
        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 0.8rem 1rem;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-input::placeholder { color: rgba(255, 255, 255, 0.5); }
        
        .form-input:focus {
            outline: none;
            border-color: var(--wave-accent);
            box-shadow: 0 0 0 2px rgba(187, 225, 250, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .form-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 0.8rem 1rem;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .form-select option {
            background: var(--wave-primary);
            color: white;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .checkbox-input {
            width: 18px;
            height: 18px;
            accent-color: var(--wave-accent);
        }
        
        .checkbox-label {
            font-size: 0.95rem;
            cursor: pointer;
        }
        
        .range-group {
            margin-top: 1rem;
        }
        
        .range-input {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            accent-color: var(--wave-accent);
        }
        
        .range-value {
            text-align: center;
            font-weight: 600;
            color: var(--wave-accent);
            margin-top: 0.5rem;
        }
        
        .help-text {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-top: 0.5rem;
            font-style: italic;
        }
        
        .info-box {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .info-title {
            color: #3498db;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .success-box {
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .success-title {
            color: #27ae60;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .warning-box {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .warning-title {
            color: #f39c12;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-active { background: var(--wave-success); }
        .status-inactive { background: var(--wave-warning); }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: var(--wave-accent);
            color: var(--wave-primary);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(187, 225, 250, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
            margin: 2rem 0;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .main-content { padding: 1rem; }
            .intro-title { font-size: 2rem; }
            .settings-form { padding: 1.5rem; }
            
            .form-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <a href="{{ url_for('dashboard') }}" class="back-btn">‚Üê Retour</a>
            <h1 class="page-title">ü§ñ Param√®tres IA</h1>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Intro Section -->
        <div class="intro-section">
            <h1 class="intro-title">Configuration IA üåä</h1>
            <p class="intro-subtitle">
                Personnalisez votre exp√©rience WaveAI en configurant vos services IA pr√©f√©r√©s.
                Vos cl√©s API sont stock√©es de mani√®re s√©curis√©e.
            </p>
        </div>

        <!-- Settings Form -->
        <form method="POST" class="settings-form">
            <!-- Free AI Section -->
            <div class="form-section">
                <h2 class="section-title">üÜì IA Gratuite (Recommand√©)</h2>
                <div class="section-description">
                    Hugging Face offre un acc√®s gratuit √† leurs mod√®les IA. 
                    Un token optionnel am√©liore les performances.
                </div>
                
                <div class="success-box">
                    <div class="success-title">‚úÖ Service Gratuit Activ√©</div>
                    <p>WaveAI utilise Hugging Face par d√©faut. Aucune configuration requise !</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="huggingface_token">
                        ü§ó Token Hugging Face (Optionnel)
                    </label>
                    <input 
                        type="password" 
                        id="huggingface_token" 
                        name="huggingface_token" 
                        class="form-input"
                        value="{% if user.ai_settings and user.ai_settings.huggingface_token %}{{ user.ai_settings.huggingface_token }}{% endif %}"
                        placeholder="hf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                    >
                    <div class="help-text">
                        Obtenez votre token sur <a href="https://huggingface.co/settings/tokens" target="_blank" style="color: var(--wave-accent);">huggingface.co</a>
                    </div>
                    <div class="api-status">
                        <div class="status-dot status-active"></div>
                        <span>Service disponible</span>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Local AI Section -->
            <div class="form-section">
                <h2 class="section-title">üè† IA Locale (Ollama)</h2>
                <div class="section-description">
                    Ollama permet d'ex√©cuter des mod√®les IA directement sur votre ordinateur.
                </div>
                
                {% if ollama_available %}
                <div class="success-box">
                    <div class="success-title">‚úÖ Ollama D√©tect√©</div>
                    <p>Ollama est install√© et fonctionne sur votre machine !</p>
                </div>
                {% else %}
                <div class="info-box">
                    <div class="info-title">‚ÑπÔ∏è Ollama Non Install√©</div>
                    <p>Installez Ollama pour une IA compl√®tement locale et priv√©e.</p>
                    <a href="https://ollama.ai" target="_blank" style="color: var(--wave-accent);">T√©l√©charger Ollama ‚Üí</a>
                </div>
                {% endif %}
                
                <div class="checkbox-group">
                    <input 
                        type="checkbox" 
                        id="use_ollama" 
                        name="use_ollama" 
                        class="checkbox-input"
                        {% if user.ai_settings and user.ai_settings.use_ollama %}checked{% endif %}
                    >
                    <label class="checkbox-label" for="use_ollama">
                        Utiliser Ollama quand disponible
                    </label>
                </div>
                
                <div class="api-status">
                    <div class="status-dot {% if ollama_available %}status-active{% else %}status-inactive{% endif %}"></div>
                    <span>{% if ollama_available %}Disponible{% else %}Non install√©{% endif %}</span>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Premium AI Section -->
            <div class="form-section">
                <h2 class="section-title">üíé IA Premium (Optionnel)</h2>
                <div class="section-description">
                    Ajoutez vos propres cl√©s API pour acc√©der aux mod√®les IA les plus avanc√©s.
                </div>
                
                <div class="warning-box">
                    <div class="warning-title">‚ö†Ô∏è Important</div>
                    <p>Ces services sont payants. Consultez les tarifs sur leurs sites officiels.</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="openai_key">üß† Cl√© API OpenAI</label>
                    <input 
                        type="password" 
                        id="openai_key" 
                        name="openai_key" 
                        class="form-input"
                        value="{% if user.ai_settings and user.ai_settings.openai_api_key %}{{ user.ai_settings.openai_api_key }}{% endif %}"
                        placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                    >
                    <div class="help-text">
                        Obtenez votre cl√© sur <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--wave-accent);">platform.openai.com</a>
                    </div>
                    <div class="api-status">
                        <div class="status-dot {% if user.ai_settings and user.ai_settings.openai_api_key %}status-active{% else %}status-inactive{% endif %}"></div>
                        <span>{% if user.ai_settings and user.ai_settings.openai_api_key %}Configur√©{% else %}Non configur√©{% endif %}</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="anthropic_key">ü§ñ Cl√© API Anthropic (Claude)</label>
                    <input 
                        type="password" 
                        id="anthropic_key" 
                        name="anthropic_key" 
                        class="form-input"
                        value="{% if user.ai_settings and user.ai_settings.anthropic_api_key %}{{ user.ai_settings.anthropic_api_key }}{% endif %}"
                        placeholder="sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                    >
                    <div class="help-text">
                        Obtenez votre cl√© sur <a href="https://console.anthropic.com/" target="_blank" style="color: var(--wave-accent);">console.anthropic.com</a>
                    </div>
                    <div class="api-status">
                        <div class="status-dot {% if user.ai_settings and user.ai_settings.anthropic_api_key %}status-active{% else %}status-inactive{% endif %}"></div>
                        <span>{% if user.ai_settings and user.ai_settings.anthropic_api_key %}Configur√©{% else %}Non configur√©{% endif %}</span>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Preferences Section -->
            <div class="form-section">
                <h2 class="section-title">‚öôÔ∏è Pr√©f√©rences</h2>
                <div class="section-description">
                    Personnalisez le comportement de vos agents IA.
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="default_model">üéØ Mod√®le IA Pr√©f√©r√©</label>
                    <select id="default_model" name="default_model" class="form-select">
                        <option value="huggingface" {% if user.ai_settings and user.ai_settings.default_model == 'huggingface' %}selected{% endif %}>
                            ü§ó Hugging Face (Gratuit)
                        </option>
                        <option value="ollama" {% if user.ai_settings and user.ai_settings.default_model == 'ollama' %}selected{% endif %}>
                            üè† Ollama (Local)
                        </option>
                        <option value="openai" {% if user.ai_settings and user.ai_settings.default_model == 'openai' %}selected{% endif %}>
                            üß† OpenAI (Premium)
                        </option>
                        <option value="anthropic" {% if user.ai_settings and user.ai_settings.default_model == 'anthropic' %}selected{% endif %}>
                            ü§ñ Anthropic (Premium)
                        </option>
                    </select>
                    <div class="help-text">
                        WaveAI utilisera automatiquement des alternatives si le mod√®le pr√©f√©r√© n'est pas disponible.
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="temperature">üå°Ô∏è Cr√©ativit√© (Temp√©rature)</label>
                    <div class="range-group">
                        <input 
                            type="range" 
                            id="temperature" 
                            name="temperature" 
                            class="range-input"
                            min="0" 
                            max="1" 
                            step="0.1" 
                            value="{% if user.ai_settings and user.ai_settings.temperature %}{{ user.ai_settings.temperature }}{% else %}0.7{% endif %}"
                            oninput="updateTemperatureValue(this.value)"
                        >
                        <div class="range-value" id="temperatureValue">
                            {% if user.ai_settings and user.ai_settings.temperature %}{{ user.ai_settings.temperature }}{% else %}0.7{% endif %}
                        </div>
                    </div>
                    <div class="help-text">
                        0 = R√©ponses pr√©cises et coh√©rentes | 1 = R√©ponses cr√©atives et vari√©es
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="max_tokens">üìù Longueur Maximale des R√©ponses</label>
                    <div class="range-group">
                        <input 
                            type="range" 
                            id="max_tokens" 
                            name="max_tokens" 
                            class="range-input"
                            min="100" 
                            max="2000" 
                            step="100" 
                            value="{% if user.ai_settings and user.ai_settings.max_tokens %}{{ user.ai_settings.max_tokens }}{% else %}1000{% endif %}"
                            oninput="updateTokensValue(this.value)"
                        >
                        <div class="range-value" id="tokensValue">
                            {% if user.ai_settings and user.ai_settings.max_tokens %}{{ user.ai_settings.max_tokens }}{% else %}1000{% endif %} tokens
                        </div>
                    </div>
                    <div class="help-text">
                        Plus de tokens = r√©ponses plus longues mais co√ªt plus √©lev√© pour les APIs payantes
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">üíæ Sauvegarder</button>
                <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚ùå Annuler</a>
            </div>
        </form>
    </div>

    <script>
        function updateTemperatureValue(value) {
            document.getElementById('temperatureValue').textContent = parseFloat(value).toFixed(1);
        }
        
        function updateTokensValue(value) {
            document.getElementById('tokensValue').textContent = value + ' tokens';
        }
        
        // Form validation
        document.querySelector('.settings-form').addEventListener('submit', function(e) {
            const openaiKey = document.getElementById('openai_key').value;
            const anthropicKey = document.getElementById('anthropic_key').value;
            
            if (openaiKey && !openaiKey.startsWith('sk-')) {
                alert('La cl√© OpenAI doit commencer par "sk-"');
                e.preventDefault();
                return false;
            }
            
            if (anthropicKey && !anthropicKey.startsWith('sk-ant-')) {
                alert('La cl√© Anthropic doit commencer par "sk-ant-"');
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>
